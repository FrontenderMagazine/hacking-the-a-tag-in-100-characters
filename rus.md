# Взлом тега `<a>` в 100 символов

Совсем недавно я обнаружил, что JavaScript позволяет _изменять атрибут `href`
тега `<a>` **после** того, как вы кликнете по нему_. Это может показаться не
таким уж серьезным на первый взгляд, но будьте уверены, так покупатели могут
попасться на крючок и передать свои личные данные мошенникам.

Давайте я покажу вам пример. <a href="http://www.paypal.co.uk/"
onclick="this.href='demo.html'">Эта ссылка должна привести вас на
PayPal</a>.

Кликните по ней и увидите, что ссылка **не ведет** на PayPal (*кроме Opera,
где это поведение, похоже, было исправлено*). Это происходит потому, что когда
вы кликнули по ссылке, я запустил код, который изменил атрибут `href`, и
браузер неожиданно повел вас по *новой ссылке*. **Такого быть не должно.**
Посетители сайта (возможно, весьма технически-образованные люди) могут и будут
считать, что попали на тот сайт, где оказались, благодаря обычным редиректам,
в данном случае, с сайта PayPal. В прошлом году PayPal на протяжении
нескольких месяцев перенаправлял пользователей с главной страницы их
британского сайта на [paypal-business.co.uk][1]. Думаю, посетители сайтов
привыкли к редиректам, и если использовать такое поведение браузеров, то оно
может представлять собой реальную угрозу пользователям. <s>Вот, что я называю
Фишинг 2.0</s>.

Давайте взглянем на JavaScript:

    // Код без сжатия
    var links = document.links;
    for(i in links) {
      links[i].onclick = function(){ this.href = 'demo.html'; };
    }

    // Сжатый код (было 100 символов; сейчас осталось 67, не считая ссылки)
    // Спасибо sgoel из HN
    o=document.links;for(i in o){o[i].onclick=function(){this.href='demo.html'}}

Этот прием сложно отследить. Практически *все*, кто использует
JavaScript/jQuery, могут повесить обработчик на тег `<a>`, а это уже не
исправить простым удалением атрибута `onclick`. А еще можно обернуть код в
`setTimeout`, и обойти любое решение этой проблемы. Любой более-менее
приличный хакер может создать вирус или встраиваемый JavaScript, который
сможет внедрить вышеуказанный код. Поскольку обновлять JavaScript (особенно
встраиваемый) невероятно просто, думаю, что такие инструменты, как
McAfeeSecure и PhishTank не продержаться против волны фишинга и секунды.

<s>Поскольку возможность обновлять ссылку после клика по ней не приносит
реальной пользы, я прошу World Wide Web Consortium (W3C) и производителей
лидирующих браузеров отключить возможность изменения атрибута `href` **после
срабатывания события `onclick`**. Это простая ошибка интерпретатора, и несмотря
на то, что такое поведение кажется кому-то нормальным, оно может быть
использовано в дурных целях. Я осознаю, что Google и ему подобные используют
такое поведение, но если мы стремимся сделать cеть безопаснее, то мы не можем
позволить таким ошибкам существовать. Есть альтернативы (например,
использование подлинных ссылок без маскировки), и поэтому эта возможность
должна быть отключена. Она не стоит того, чтобы пользователи становились
жертвами мошенничества и воровства</s>

**Обновление (19.03)** — Моя новая просьба состоит в том, чтобы **предупреждать
пользователей о том, что адрес ссылки изменяется на другой домен после клика**
([+1 abididea][2]). Такие сайты как Google и Facebook могут продолжать
нормально работать в рамках одного и того же домена, Интернет в безопасности,
а возможность фишинга устранена. Все остаются в выигрыше (кроме самих
фишеров, конечно!). Мне **нужна ваша помощь**, чтобы убедить вендоров основных
браузеров как можно скорее исправить ситуацию. Давайте лишим мошенников еще
одного способа обманывать пользователей.

**Обновление (19.03)** — Я предложил исправление в Firefox, жду ответа.

[1]: http://paypal-business.co.uk/
[2]: http://www.reddit.com/user/abadidea
